# シナリオテスト — code2map

## 指示

以下のシナリオを順番に実行し、試験項目ごとに OK / NG を判定してください。
結果は `docs/tests/results/YYYYMMDD-HHMM-scenario.md` に報告してください。

- 結果報告の冒頭にサマリー（OK数 / NG数 / MANUAL数 / 総数、NG項目の一覧）を出力すること
- MANUAL の項目はスキップし、結果に MANUAL と記載すること
- NG の場合は、エラー内容や実際の出力を備考に記載すること
- 各シナリオの手順に従い、試験項目の判定基準で合否を判断すること
- pythonの実行はuvを使うこと

## シナリオ1: 初回セットアップ

### 手順

1. リポジトリを clone する
2. README に記載された手順（`uv sync --all-extras`）でインストールする
3. `uv run code2map --help` でヘルプが表示されることを確認する

### 試験項目

| # | 試験項目 | 実行 | 判定基準 |
|---|---------|:----:|---------|
| 1-1 | clone が成功する | AI | 終了コード 0、エラーなし |
| 1-2 | `uv sync --all-extras` が成功する | AI | 終了コード 0、エラーなし |
| 1-3 | `uv run code2map --help` が表示される | AI | usage 情報が出力される |

## シナリオ2: Python ファイルの解析

### 手順

1. テストフィクスチャの Python ファイルを解析する
2. 出力ディレクトリに INDEX.md、MAP.json、parts/ が生成されることを確認する
3. 出力内容の整合性を確認する

### 試験項目

| # | 試験項目 | 実行 | 判定基準 |
|---|---------|:----:|---------|
| 2-1 | `uv run code2map build tests/fixtures/sample.py --out /tmp/test_py` が正常終了する | AI | 終了コード 0 |
| 2-2 | INDEX.md が生成される | AI | ファイルが存在し空でない |
| 2-3 | MAP.json が有効な JSON である | AI | `json.loads` でエラーなし |
| 2-4 | MAP.json の `part_file` が全て実在する | AI | 各パスに対応するファイルが `/tmp/test_py/` 内に存在する |
| 2-5 | parts/ 内のファイル名に OS 禁止文字がない | AI | `< > : " / \ \| ? *` を含まない |

## シナリオ3: Java ファイルの解析

### 手順

1. テストフィクスチャの Java ファイルを解析する
2. コンストラクタ（`<init>`）を含むクラスが正しくサニタイズされることを確認する

### 試験項目

| # | 試験項目 | 実行 | 判定基準 |
|---|---------|:----:|---------|
| 3-1 | `uv run code2map build tests/fixtures/sample.java --out /tmp/test_java` が正常終了する | AI | 終了コード 0 |
| 3-2 | parts/ 内のファイル名に OS 禁止文字がない | AI | `< > : " / \ \| ? *` を含まない |
| 3-3 | MAP.json の `part_file` が全て実在する | AI | 各パスに対応するファイルが `/tmp/test_java/` 内に存在する |
| 3-4 | INDEX.md のリンク先が全て実在する | AI | INDEX.md 内のファイル参照が `/tmp/test_java/` 内に存在する |

## シナリオ4: ドライラン

### 手順

1. `--dry-run` オプション付きで実行する
2. ファイルが生成されず、プレビューのみ出力されることを確認する

### 試験項目

| # | 試験項目 | 実行 | 判定基準 |
|---|---------|:----:|---------|
| 4-1 | `uv run code2map build tests/fixtures/sample.py --out /tmp/test_dry --dry-run` が正常終了する | AI | 終了コード 0 |
| 4-2 | 出力ディレクトリにファイルが生成されない | AI | `/tmp/test_dry/` が存在しない、または空 |

## シナリオ5: エラーケース

### 手順

1. 存在しないファイル、空ファイル、非対応ファイルを入力してエラーハンドリングを確認する

### 試験項目

| # | 試験項目 | 実行 | 判定基準 |
|---|---------|:----:|---------|
| 5-1 | 存在しないファイルを指定 | AI | 終了コード 0 以外、エラーメッセージが出力される |
| 5-2 | 空ファイルを指定（`tests/fixtures/empty.py`） | AI | クラッシュせずに終了する |
| 5-3 | 非対応ファイルを指定（`tests/fixtures/sample.txt`） | AI | クラッシュせずにエラーメッセージが出力される |

## 結果報告フォーマット

```markdown
# シナリオテスト結果報告

実行日時: YYYY-MM-DD HH:MM
実行者: Claude Code / 担当者名
対象: code2map vX.Y.Z

## サマリー

- 結果: **OK: X / NG: X / MANUAL: X / 全 17 項目**
- NG項目: （なし、または NG 項目の # と試験項目を列挙）

## シナリオ1: 初回セットアップ

| # | 試験項目 | 結果 | 備考 |
|---|---------|------|------|
| 1-1 | clone が成功する | | |
| 1-2 | uv sync が成功する | | |
| 1-3 | --help が表示される | | |

## シナリオ2: Python ファイルの解析

| # | 試験項目 | 結果 | 備考 |
|---|---------|------|------|
| 2-1 | コマンドが正常終了する | | |
| 2-2 | INDEX.md が生成される | | |
| 2-3 | MAP.json が有効な JSON | | |
| 2-4 | part_file が全て実在する | | |
| 2-5 | ファイル名に禁止文字がない | | |

## シナリオ3: Java ファイルの解析

| # | 試験項目 | 結果 | 備考 |
|---|---------|------|------|
| 3-1 | コマンドが正常終了する | | |
| 3-2 | ファイル名に禁止文字がない | | |
| 3-3 | part_file が全て実在する | | |
| 3-4 | INDEX.md のリンク先が実在する | | |

## シナリオ4: ドライラン

| # | 試験項目 | 結果 | 備考 |
|---|---------|------|------|
| 4-1 | コマンドが正常終了する | | |
| 4-2 | ファイルが生成されない | | |

## シナリオ5: エラーケース

| # | 試験項目 | 結果 | 備考 |
|---|---------|------|------|
| 5-1 | 存在しないファイル | | |
| 5-2 | 空ファイル | | |
| 5-3 | 非対応ファイル | | |

```
